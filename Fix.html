<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Priyo Pay Chat Widget</title>
  <style>
    body { margin:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    #chatBubble { position:fixed; bottom:20px; right:20px; width:56px; height:56px; border-radius:50%; background:#E60023; display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:9999; box-shadow:0 4px 12px rgba(0,0,0,.3);}
    #chatBubble img { width:32px; height:32px; pointer-events:none; }

    #chatWidget { position:fixed; bottom:90px; right:20px; width:360px; height:560px; display:none; flex-direction:column; background:#fff; border-radius:20px; box-shadow:0 8px 32px rgba(0,0,0,.3); z-index:10000; overflow:hidden; }
    .chat-header { background:#000; padding:15px 20px; display:flex; justify-content:center; align-items:center; border-radius:20px 20px 0 0; flex-shrink:0; }
    .chat-header img { width:120px; user-select:none; }
    #chatCloseBtn { position:absolute; right:15px; top:50%; transform:translateY(-50%); color:#fff; font-size:26px; cursor:pointer; }

    .chat-tabs { display:flex; justify-content:center; gap:12px; background:#000; padding:8px 10px; border-radius:0 0 20px 20px; flex-shrink:0; }
    .chat-tab { flex:1; max-width:110px; padding:8px 14px; border-radius:25px; background:#222; color:#fff; font-weight:600; display:flex; align-items:center; justify-content:center; gap:6px; cursor:pointer; }
    .chat-tab.active { background:#E60023; }

    /* Each tab content is a flex child, with its own scrolling area */
    #tabChat, #tabHelp, #tabFAQ { padding:10px; flex:1 1 auto; overflow:hidden; display:none; box-sizing:border-box; }
    #tabChat { display:block; }

    /* Chat body is the scrollable column; we will set its padding-bottom dynamically */
    #chatBody { height:100%; display:flex; flex-direction:column; gap:6px; overflow-y:auto; padding:12px; box-sizing:border-box; }

    /* Footer: keep in DOM always; hide visually when not needed (visibility) */
    .chat-footer { display:flex; gap:10px; padding:10px; align-items:center; background:#f2f2f2; border-radius:0 0 20px 20px; flex-shrink:0; box-sizing:border-box; position:relative; }
    .chat-footer[aria-hidden="true"] { visibility:hidden; pointer-events:none; opacity:0; } /* still occupies layout space */
    #chatInput { flex:1; padding:10px 14px; border-radius:25px; border:1px solid #ccc; font-size:14px; outline:none; box-sizing:border-box; }
    #sendBtn { width:42px; height:42px; border-radius:50%; background:#E60023; border:none; color:#fff; display:flex; align-items:center; justify-content:center; cursor:pointer; }

    .message { display:flex; align-items:flex-start; gap:10px; }
    .message.user { justify-content:flex-end; text-align:right; }
    .message-text { max-width:75%; padding:10px 16px; border-radius:20px; white-space:pre-wrap; word-wrap:break-word; }
    .message.bot .message-text { background:#f0f0f0; color:#000; border-bottom-left-radius:0; }
    .message.user .message-text { background:#E60023; color:#fff; border-bottom-right-radius:0; }

    .avatar { width:32px; height:32px; border-radius:50%; background-size:cover; background-position:center; flex-shrink:0; }
    .avatar.bot { background-image:url('https://i.imgur.com/4DB1BHj.png'); }
    .avatar.user { background-image:url('https://i.ibb.co/x6vqgKx/user-icon.png'); }

    #typingIndicator { font-style:italic; color:#666; font-size:13px; display:none; margin-top:6px; }

    @media (max-width:480px) {
      #chatWidget { width:95vw; height:60vh; right:2.5vw; bottom:80px; }
    }
  </style>
</head>
<body>
  <div id="chatBubble" role="button" tabindex="0" aria-label="Open chat" title="Open chat">
    <img src="https://i.imgur.com/4DB1BHj.png" alt="Bot Icon"/>
  </div>

  <div id="chatWidget" role="region" aria-label="Priyo Pay Chat Widget" tabindex="0" aria-live="polite">
    <div class="chat-header">
      <img src="https://imgur.com/OrhhQLr.png" alt="Priyo Pay Logo"/>
      <span id="chatCloseBtn" role="button" tabindex="0" aria-label="Minimize chat" title="Minimize chat">&times;</span>
    </div>

    <div class="chat-tabs" role="tablist" aria-label="Chat navigation tabs">
      <div class="chat-tab active" id="tabChatBtn" role="tab" aria-selected="true" tabindex="0">Chat</div>
      <div class="chat-tab" id="tabHelpBtn" role="tab" aria-selected="false" tabindex="0">Help</div>
      <div class="chat-tab" id="tabFAQBtn" role="tab" aria-selected="false" tabindex="0">FAQ</div>
    </div>

    <div id="tabChat" role="tabpanel" aria-labelledby="tabChatBtn" tabindex="0">
      <div id="chatBody" aria-live="polite" aria-relevant="additions"></div>
      <div id="typingIndicator">Priyo is typing...</div>
    </div>

    <div id="tabHelp" role="tabpanel" aria-labelledby="tabHelpBtn" tabindex="0" style="display:none;">
      <div style="height:100%; display:flex; flex-direction:column; overflow:auto;">
        <h3>Help Articles</h3>
        <ul><li>How to load USD</li><li>Create card</li><li>Update KYC</li></ul>
      </div>
    </div>

    <div id="tabFAQ" role="tabpanel" aria-labelledby="tabFAQBtn" tabindex="0" style="display:none;">
      <div style="height:100%; display:flex; flex-direction:column; overflow:auto;">
        <h3>Frequently Asked Questions</h3>
        <ul><li>Whatâ€™s the subscription fee?</li><li>How to get virtual card?</li><li>Can I transfer to bKash?</li></ul>
      </div>
    </div>

    <div class="chat-footer" id="chatFooter" aria-hidden="false">
      <input id="chatInput" type="text" placeholder="Type your message..." aria-label="Type your message" autocomplete="off"/>
      <button id="sendBtn" aria-label="Send message">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="white"><path d="M2 21l21-9L2 3v7l15 2-15 2z"/></svg>
      </button>
    </div>
  </div>

  <script>
    /* Elements */
    const chatBubble = document.getElementById('chatBubble');
    const chatWidget = document.getElementById('chatWidget');
    const chatCloseBtn = document.getElementById('chatCloseBtn');
    const tabChatBtn = document.getElementById('tabChatBtn');
    const tabHelpBtn = document.getElementById('tabHelpBtn');
    const tabFAQBtn = document.getElementById('tabFAQBtn');
    const tabContents = {
      chat: document.getElementById('tabChat'),
      help: document.getElementById('tabHelp'),
      faq: document.getElementById('tabFAQ'),
    };
    const chatBody = document.getElementById('chatBody');
    const chatFooter = document.getElementById('chatFooter');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');
    const typingIndicator = document.getElementById('typingIndicator');

    let isChatOpen = false;
    let activeTab = 'chat';

    function openWidget() {
      chatWidget.style.display = 'flex';
      isChatOpen = true;
      // ensure tab content padding reserves footer space
      adjustChatPadding();
      // small delay then focus
      setTimeout(() => {
        try { chatInput.focus(); } catch(e){}
        scrollToBottom('auto');
      }, 120);
    }

    function closeWidget() {
      chatWidget.style.display = 'none';
      isChatOpen = false;
    }

    chatBubble.addEventListener('click', () => {
      if (isChatOpen) closeWidget(); else openWidget();
    });
    chatBubble.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); chatBubble.click(); }
    });
    chatCloseBtn.addEventListener('click', closeWidget);

    /* Always keep footer in DOM. Toggle visible vs hidden (keeps layout) */
    function showFooter() {
      chatFooter.setAttribute('aria-hidden', 'false');
      chatFooter.style.visibility = 'visible';
      chatFooter.style.pointerEvents = 'auto';
    }
    function hideFooter() {
      // don't remove from layout; only hide interactions and visibility
      chatFooter.setAttribute('aria-hidden', 'true');
      chatFooter.style.visibility = 'hidden';
      chatFooter.style.pointerEvents = 'none';
    }

    /* Set chatBody padding-bottom to footer height to reserve space */
    function adjustChatPadding() {
      try {
        const footerHeight = chatFooter.offsetHeight || 56;
        // apply to chat tab only
        tabContents.chat.style.paddingBottom = (footerHeight + 8) + 'px';
        // also apply to other tabs if you want consistent spacing
        tabContents.help.style.paddingBottom = (footerHeight + 8) + 'px';
        tabContents.faq.style.paddingBottom = (footerHeight + 8) + 'px';
      } catch (e) {
        // ignore
      }
    }

    function switchTo(tab) {
      if (tab === activeTab) return;
      activeTab = tab;
      // update tab UI
      [tabChatBtn, tabHelpBtn, tabFAQBtn].forEach(btn => btn.classList.remove('active'));
      if (tab === 'chat') tabChatBtn.classList.add('active');
      if (tab === 'help') tabHelpBtn.classList.add('active');
      if (tab === 'faq') tabFAQBtn.classList.add('active');

      // show/hide panels
      tabContents.chat.style.display = (tab === 'chat') ? 'block' : 'none';
      tabContents.help.style.display = (tab === 'help') ? 'block' : 'none';
      tabContents.faq.style.display = (tab === 'faq') ? 'block' : 'none';

      if (tab === 'chat') {
        showFooter();                // keep layout but show input
        // force a reflow and then adjust padding/scroll
        void chatFooter.offsetHeight;
        adjustChatPadding();
        setTimeout(() => { try { chatInput.focus(); } catch(e){}; scrollToBottom('smooth'); }, 80);
      } else {
        // hide footer visually but keep layout reserved
        hideFooter();
        // blur to avoid mobile keyboard sticking
        try { chatInput.blur(); } catch(e){}
      }
    }

    tabChatBtn.addEventListener('click', () => switchTo('chat'));
    tabHelpBtn.addEventListener('click', () => switchTo('help'));
    tabFAQBtn.addEventListener('click', () => switchTo('faq'));

    /* Scroll helper */
    function scrollToBottom(behavior='auto') {
      if (!chatBody) return;
      chatBody.scrollTo({ top: chatBody.scrollHeight, behavior });
    }

    /* Mutations: keep pinned bottom when new messages arrive */
    const obs = new MutationObserver(() => {
      if (isChatOpen && activeTab === 'chat') scrollToBottom('auto');
    });
    obs.observe(chatBody, { childList:true, subtree:true });

    /* When keyboard opens/resizes or tab visibility changes, recalc */
    window.addEventListener('resize', () => {
      adjustChatPadding();
      if (isChatOpen && activeTab === 'chat') setTimeout(() => scrollToBottom('auto'), 120);
    });
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible' && isChatOpen && activeTab === 'chat') {
        adjustChatPadding();
        requestAnimationFrame(() => scrollToBottom('smooth'));
      }
    });

    /* Basic messaging simulation */
    function addMessage(text, sender='bot') {
      const div = document.createElement('div');
      div.className = 'message ' + (sender === 'user' ? 'user' : 'bot');
      const avatar = document.createElement('div');
      avatar.className = 'avatar ' + (sender === 'user' ? 'user' : 'bot');
      const txt = document.createElement('div');
      txt.className = 'message-text';
      txt.textContent = text;
      div.appendChild(avatar);
      div.appendChild(txt);
      chatBody.appendChild(div);
      scrollToBottom('smooth');
    }

    sendBtn.addEventListener('click', async () => {
      const t = chatInput.value.trim();
      if (!t || activeTab !== 'chat') return;
      addMessage(t, 'user');
      chatInput.value = '';
      typingIndicator.style.display = 'block';
      await new Promise(r => setTimeout(r, 900));
      addMessage(`You said: "${t}"`, 'bot');
      typingIndicator.style.display = 'none';
    });

    chatInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey && activeTab === 'chat') {
        e.preventDefault();
        sendBtn.click();
      }
    });

    // initial setup
    adjustChatPadding();
    switchTo('chat'); // ensures footer visible and padding set
    // show bubble, keep widget closed initially
    chatBubble.style.display = 'flex';
  </script>
</body>
</html>
